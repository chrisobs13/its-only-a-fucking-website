<h1>flagged-respawn <a href="http://travis-ci.org/tkellen/node-flagged-respawn"><img src="https://secure.travis-ci.org/tkellen/node-flagged-respawn.png" alt="Build Status" /></a></h1>
<blockquote>
  <p>A tool for respawning node binaries when special flags are present.</p>
</blockquote>

<p><a href="https://nodei.co/npm/flagged-respawn/"><img src="https://nodei.co/npm/flagged-respawn.png" alt="NPM" /></a></p>

<h2>What is it?</h2>

<p>Say you wrote a command line tool that runs arbitrary javascript (e.g. task runner, test framework, etc). For the sake of discussion, let’s pretend it’s a testing harness you’ve named <code>testify</code>.</p>

<p>Everything is going splendidly until one day you decide to test some code that relies on a feature behind a v8 flag in node (<code>--harmony</code>, for example).  Without much thought, you run <code>testify --harmony spec tests.js</code>.</p>

<p>It doesn’t work. After digging around for a bit, you realize this produces a <a href="http://nodejs.org/docs/latest/api/process.html#process_process_argv"><code>process.argv</code></a> of:</p>

<p><code>['node', '/usr/local/bin/test', '--harmony', 'spec', 'tests.js']</code></p>

<p>Crap. The <code>--harmony</code> flag is in the wrong place! It should be applied to the <strong>node</strong> command, not our binary. What we actually wanted was this:</p>

<p><code>['node', '--harmony', '/usr/local/bin/test', 'spec', 'tests.js']</code></p>

<p>Flagged-respawn fixes this problem and handles all the edge cases respawning creates, such as:
- Providing a method to determine if a respawn is needed.
- Piping stderr/stdout from the child into the parent.
- Making the parent process exit with the same code as the child.
- If the child is killed, making the parent exit with the same signal.</p>

<p>To see it in action, clone this repository and run <code>npm install</code> / <code>npm run respawn</code> / <code>npm run nospawn</code>.</p>

<h2>Sample Usage</h2>

<p>```js
#!/usr/bin/env node</p>

<p>const flaggedRespawn = require(‘flagged-respawn’);</p>

<p>// get a list of all possible v8 flags for the running version of node
const v8flags = require(‘v8flags’).fetch();</p>

<p>flaggedRespawn(v8flags, process.argv, function (ready, child) {
  if (ready) {
    console.log(‘Running!’);
    // your cli code here
  } else {
    console.log(‘Special flags found, respawning.’);
  }
  if (process.pid !== child.pid) {
    console.log(‘Respawned to PID:’, child.pid);
  }
});</p>

<p>```</p>

<h2>Release History</h2>

<ul>
  <li>2014-09-12 - v0.3.1 - use <code>{ stdio: 'inherit' }</code> for spawn to maintain colors</li>
  <li>2014-09-11 - v0.3.0 - for real this time</li>
  <li>2014-09-11 - v0.2.0 - cleanup</li>
  <li>2014-09-04 - v0.1.1 - initial release</li>
</ul>
